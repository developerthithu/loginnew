<!DOCTYPE html>
<html>
<head>
<title>Facebook Login JavaScript Example</title>
<meta charset="UTF-8">
</head>
<body>
<script>
  //[1]Load lên các thành phần cần thiết
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '996824617632539',
      cookie     : true,                     
      xfbml      : true,                 
      version    : 'v13.0'          
    });
  //Kiểm tra trạng thái hiện tại
    FB.getLoginStatus(function(response) {  
      statusChangeCallback(response);       
    });
  };
//[2] Xử lý trạng thái đăng nhập
  function statusChangeCallback(response) {  
    console.log('statusChangeCallback');
    console.log(response);   
    //Người dùng đã đăng nhập vào facebook và đăng nhập vào ứng dụng               
    if (response.status === 'connected') {   
      testAPI();
      postAPI();
      // Người dùng đã đăng nhập vào facebook nhưng chưa đăng nhập vào ứng dụng
    } else if(response.status === 'not_authorized') {                                
      document.getElementById('status').innerHTML = 'đã đăng nhập vào facebook nhưng chưa đăng nhập vào ứng dụng';
    // Người dùng chưa đăng nhập vào facebook
    }else{
        document.getElementById('status').innerHTML = 'người dùng chưa đăng nhập vào facebook';
    }
  }
  function checkLoginState() {              
    FB.getLoginStatus(function(response) {   
      statusChangeCallback(response);
    });
  }
  (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
  

function testAPI() {                      
    console.log('get fanpage, content');
    FB.api(
    '/me/accounts',
    'GET',
    {"fields":"id,global_brand_page_name,link"},
    function(response) {
      console.log(response);
      getFanpages(response);
    });
  }
  idPage = 100699045974748;
  function postAPI() {                     
    console.log('get post fanpage');
    FB.api(
    '/'+ idPage +'/posts',
    'GET',
    {"fields":"id,message,created_time,full_picture,permalink_url"},
    function(response) {
      // Insert your code here
      console.log(response);
      getPosts(response);
    });
  }
  function getFanpages(page){
    sumpage = page.data.length;
    idPage_1 = page.data[0].id;
    idPage_2 = page.data[1].id;
    namePage_1 = page.data[0].global_brand_page_name;
    namePage_2 = page.data[1].global_brand_page_name;
    linkPage_1 = page.data[0].link;
    linkPage_2 = page.data[1].link;
    showInforPage = `
      <p>Thông tin Fanpage</p>
        <ul class="">
          <li class="">Tổng số fanpage: ${sumpage}</li>
          <li class="">fanpage 1: Có id: ${idPage_1}  tên fanpage:${namePage_1}  link: <a href="${linkPage_1}">Đi đến trang fanpage</a></li>
          <li class="">fanpage 2: Có id: ${idPage_2}  tên fanpage:${namePage_2}  link: <a href="${linkPage_2}">Đi đến trang fanpage</a></li>
        </ul>
      `
    document.getElementById('showInforPage').innerHTML = showInforPage;
  }
  function getPosts(post){
    sumPost = post.data.length;
    idPost_1 = post.data[0].id;
    mesPost_1 = post.data[0].message;
    dayPost_1 = post.data[0].created_time;
    linkPost_1 = post.data[0].permalink_url;
    idPost_2 = post.data[1].id;
    mesPost_2 = post.data[1].message;
    dayPost_2 = post.data[1].created_time;
    linkPost_2 = post.data[1].permalink_url;
    picPost_2 = post.data[1].full_picture;
    for(var i=0; i<post.data.length; i++){
      showInforPost_1= `
      <ul class="">
          <li class="">Tổng số bài đăng: ${sumPost}</li>
          <li class="">Bài đăng 1: </li>
          <li class=""> id: ${post.data[i].id} </li>
          <li class=""> Nội dung:${post.data[i].message} </li>
          <li class=""> Ngày đăng:${post.data[i].created_time} </li>
          <li> link <a href="${post.data[i].permalink_url}">Đi đến bài đăng</a></li>
          </ul>
        `;
      showInforPost_1++;
    }
    document.getElementById('showPost').innerHTML = showInforPost_1;
    showInforPost = `
      <p>Thông tin bài đăng của fanpage có id: ${idPage}</p>
        <ul class="">
          <li class="">Tổng số bài đăng: ${sumPost}</li>
          <li class="">Bài đăng 1: </li>
          <li class=""> id: ${idPost_1} </li>
          <li class=""> Nội dung:${mesPost_1} </li>
          <li class=""> Ngày đăng:${dayPost_1} </li>
          <li> link <a href="${linkPost_1}">Đi đến bài đăng</a></li>
          </br>
          <li class="">Bài đăng 2: </li>
          <li class=""> id: ${idPost_2} </li>
          <li class=""> Nội dung:${mesPost_2} </li>
          <li class=""> ảnh: </li>
          <li><img src="${picPost_2}" alt=""></li>
          <li class=""> Ngày đăng:${dayPost_2} </li>
          <li> link <a href="${linkPost_2}">Đi đến bài đăng</a></li>
        </ul>
      `
    document.getElementById('showInforPost').innerHTML = showInforPost;
  }
</script
<!-- The JS SDK Login Button -->

<fb:login-button scope="public_profile,email" onlogin="checkLoginState();"> 
</fb:login-button>
<!--Login status-->  
<div id="status">
</div>
<!--Get page-->
<div id="showInforPage">
</div>
<!--Get post-->
<div id="showInforPost">
</div>
<!--Get post-->
<div id="showPost">
</div>
<!-- Load the JS SDK asynchronously -->
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

</div>
</body>
</html>
